{% with url_name=request.resolver_match.url_name %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Djangonista{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom dropdown styling for dark theme */
      select {
        background-color: rgb(30 41 59) !important; /* slate-800 */
        color: white !important;
      }
      select option {
        background-color: rgb(30 41 59) !important; /* slate-800 */
        color: white !important;
      }
      select:focus option {
        background-color: rgb(30 41 59) !important;
        color: white !important;
      }
    </style>
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100">
    <div class="border-b border-white/10 bg-slate-950/80 backdrop-blur">
      <div class="mx-auto flex max-w-6xl flex-col gap-2 px-6 py-4 md:flex-row md:items-center md:justify-between">
        <a href="{% url 'hub:home' %}" class="text-xl font-bold tracking-tight text-sky-200">Djangonista</a>
        
        <!-- Global Search Bar -->
        <div class="relative mb-4 md:mb-0">
          <div class="relative">
            <input 
              type="text" 
              id="global-search" 
              placeholder="Search people, communities, schools..." 
              class="w-full md:w-80 rounded-lg border border-white/20 bg-white/10 px-4 py-2 pl-10 text-white placeholder-slate-400 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-400/20"
            >
            <svg class="absolute left-3 top-2.5 h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
          <!-- Search Results Dropdown -->
          <div id="search-results" class="absolute top-full left-0 right-0 mt-2 hidden bg-slate-800 border border-white/20 rounded-lg shadow-lg z-50 max-h-96 overflow-y-auto">
            <div id="search-loading" class="p-4 text-center text-slate-400 hidden">
              <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-sky-400 mx-auto"></div>
            </div>
            <div id="search-content" class="p-2"></div>
          </div>
        </div>

        <nav class="flex flex-wrap gap-3 text-sm font-semibold uppercase tracking-wide text-slate-300">
          <a class="{% if url_name == 'people' or url_name == 'person-detail' %}text-sky-200 bg-sky-500/20{% endif %} px-4 py-2 rounded-xl hover:bg-sky-500/5 transition-colors duration-200 flex items-center gap-1 hover:text-white transition-colors duration-200" href="{% url 'hub:people' %}">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" class="size-4">
                <path d="M13 11C13 8.79086 11.2091 7 9 7C6.79086 7 5 8.79086 5 11C5 13.2091 6.79086 15 9 15C11.2091 15 13 13.2091 13 11Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M11.0386 7.55773C11.0131 7.37547 11 7.18927 11 7C11 4.79086 12.7909 3 15 3C17.2091 3 19 4.79086 19 7C19 9.20914 17.2091 11 15 11C14.2554 11 13.5584 10.7966 12.9614 10.4423" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M15 21C15 17.6863 12.3137 15 9 15C5.68629 15 3 17.6863 3 21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M21 17C21 13.6863 18.3137 11 15 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            People
          </a>

          <a class="{% if url_name == 'communities' or url_name == 'community-detail' %}text-sky-200 bg-sky-500/20{% endif %} px-4 py-2 rounded-xl hover:bg-sky-500/5 transition-colors duration-200 flex items-center gap-1 hover:text-white transition-colors duration-200" href="{% url 'hub:communities' %}">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" class="size-4">
                <path d="M2 11C4.3317 8.55783 7.64323 8.44283 10 11M8.49509 4.5C8.49509 5.88071 7.37421 7 5.99153 7C4.60885 7 3.48797 5.88071 3.48797 4.5C3.48797 3.11929 4.60885 2 5.99153 2C7.37421 2 8.49509 3.11929 8.49509 4.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>
                <path d="M14 22C16.3317 19.5578 19.6432 19.4428 22 22M20.4951 15.5C20.4951 16.8807 19.3742 18 17.9915 18C16.6089 18 15.488 16.8807 15.488 15.5C15.488 14.1193 16.6089 13 17.9915 13C19.3742 13 20.4951 14.1193 20.4951 15.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>
                <path d="M3 14C3 17.87 6.13 21 10 21L9 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M15 3H21M15 6H21M15 9H18.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            Communities
          </a>
          <a class="{% if url_name == 'schools' or url_name == 'school-detail' %}text-sky-200 bg-sky-500/20{% endif %} px-4 py-2 rounded-xl hover:bg-sky-500/5 transition-colors duration-200 flex items-center gap-1 hover:text-white transition-colors duration-200" href="{% url 'hub:schools' %}">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" class="size-4">
                <path d="M7 22V12.2757C7 11.1939 7 10.653 7.24458 10.1993C7.48915 9.74558 7.93843 9.45308 8.83697 8.86808L10.9185 7.51291C11.4437 7.17097 11.7063 7 12 7C12.2937 7 12.5563 7.17097 13.0815 7.51291L15.163 8.86808C16.0616 9.45308 16.5108 9.74558 16.7554 10.1993C17 10.653 17 11.1939 17 12.2757V22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 13H12.009" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M20 22V17.1623C20 14.8707 19.0556 14.6852 17 14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M4 22V17.1623C4 14.8707 4.94437 14.6852 7 14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M2 22H22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M12 7V4.98221M12 4.98221V2.97035C12 2.49615 12 2.25905 12.1464 2.11173C12.6061 1.64939 14.5 2.74303 15.2203 3.18653C15.8285 3.56105 16 4.30914 16 4.98221H12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M10 22L10 19C10 18.0572 10 17.5858 10.2929 17.2929C10.5858 17 11.0572 17 12 17C12.9428 17 13.4142 17 13.7071 17.2929C14 17.5858 14 18.0572 14 19V22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            Schools
          </a>
        </nav>

      </div>
    </div>

    <main class="mx-auto w-full max-w-6xl px-6 py-14">
      {% block content %}{% endblock %}
    </main>

    <footer class="border-t border-white/10 bg-slate-950/90 py-6 text-sm text-slate-400">
      <div class="mx-auto flex max-w-6xl flex-col gap-3 px-6 md:flex-row md:items-center md:justify-between">
        <p>&copy; {% now "Y" %} Django Cameroon Â· Djangonista.</p>
        <p>Join <a class="text-sky-300 hover:underline" href="https://hacktoberfest.com/">Hacktoberfest 2025</a>.</p>
      </div>
    </footer>

    <script>
      // Live search functionality
      document.addEventListener('DOMContentLoaded', function() {
        const searchForms = document.querySelectorAll('form[data-live-search]');
        
        searchForms.forEach(form => {
          const searchInput = form.querySelector('input[name="search"]');
          const selectInputs = form.querySelectorAll('select');
          let searchTimeout;
          
          function performSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
              form.submit();
            }, 500); // Debounce search by 500ms
          }
          
          if (searchInput) {
            searchInput.addEventListener('input', performSearch);
          }
          
          selectInputs.forEach(select => {
            select.addEventListener('change', () => {
              form.submit();
            });
          });
        });

        // Global search functionality
        const globalSearchInput = document.getElementById('global-search');
        const searchResults = document.getElementById('search-results');
        const searchLoading = document.getElementById('search-loading');
        const searchContent = document.getElementById('search-content');
        let globalSearchTimeout;

        if (globalSearchInput) {
          globalSearchInput.addEventListener('input', function() {
            const query = this.value.trim();
            
            clearTimeout(globalSearchTimeout);
            
            if (query.length < 2) {
              searchResults.classList.add('hidden');
              return;
            }

            // Show loading
            searchResults.classList.remove('hidden');
            searchLoading.classList.remove('hidden');
            searchContent.innerHTML = '';

            globalSearchTimeout = setTimeout(() => {
              fetch(`{% url 'hub:search-api' %}?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                  searchLoading.classList.add('hidden');
                  
                  let html = '';
                  
                  if (data.people.length > 0) {
                    html += '<div class="p-2"><h3 class="text-xs font-semibold text-slate-400 uppercase tracking-wide mb-2">People</h3>';
                    data.people.forEach(person => {
                      html += `
                        <a href="${person.url}" class="flex items-center gap-3 p-2 hover:bg-slate-700 rounded-lg">
                          ${person.avatar ? `<img src="${person.avatar}" alt="${person.name}" class="w-8 h-8 rounded-full object-cover">` : `<div class="w-8 h-8 rounded-full bg-sky-500/20 flex items-center justify-center text-sm font-bold text-sky-200">${person.name[0]}</div>`}
                          <div>
                            <div class="text-white font-medium">${person.name}</div>
                            <div class="text-sm text-slate-400">${person.role}</div>
                          </div>
                        </a>
                      `;
                    });
                    html += '</div>';
                  }

                  if (data.communities.length > 0) {
                    html += '<div class="p-2"><h3 class="text-xs font-semibold text-slate-400 uppercase tracking-wide mb-2">Communities</h3>';
                    data.communities.forEach(community => {
                      html += `
                        <a href="${community.url}" class="flex items-center gap-3 p-2 hover:bg-slate-700 rounded-lg">
                          ${community.logo ? `<img src="${community.logo}" alt="${community.name}" class="w-8 h-8 rounded-lg object-cover">` : `<div class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center text-sm font-bold text-purple-200">${community.name[0]}</div>`}
                          <div>
                            <div class="text-white font-medium">${community.name}</div>
                            <div class="text-sm text-slate-400">${community.location || ''}</div>
                          </div>
                        </a>
                      `;
                    });
                    html += '</div>';
                  }

                  if (data.schools.length > 0) {
                    html += '<div class="p-2"><h3 class="text-xs font-semibold text-slate-400 uppercase tracking-wide mb-2">Schools</h3>';
                    data.schools.forEach(school => {
                      html += `
                        <a href="${school.url}" class="flex items-center gap-3 p-2 hover:bg-slate-700 rounded-lg">
                          <div class="w-8 h-8 rounded-lg bg-teal-500/20 flex items-center justify-center text-sm font-bold text-teal-200">${school.name[0]}</div>
                          <div>
                            <div class="text-white font-medium">${school.name}</div>
                            <div class="text-sm text-slate-400">${school.city || ''}</div>
                          </div>
                        </a>
                      `;
                    });
                    html += '</div>';
                  }

                  if (html === '') {
                    html = '<div class="p-4 text-center text-slate-400">No results found</div>';
                  }

                  searchContent.innerHTML = html;
                })
                .catch(error => {
                  searchLoading.classList.add('hidden');
                  searchContent.innerHTML = '<div class="p-4 text-center text-red-400">Error loading results</div>';
                });
            }, 300);
          });

          // Hide search results when clicking outside
          document.addEventListener('click', function(e) {
            if (!globalSearchInput.contains(e.target) && !searchResults.contains(e.target)) {
              searchResults.classList.add('hidden');
            }
          });
        }
      });
    </script>
  </body>
</html>
{% endwith %}
